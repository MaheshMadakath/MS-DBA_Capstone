bseNsePrice = {
                "bse":0,
                "nse":0
              };
var accordion=function(){
	var tm=sp=10;
	function slider(n){this.nm=n; this.arr=[]}
	slider.prototype.init=function(t,c,k){
		var a,h,s,l,i; a=document.getElementById(t); this.sl=k?k:'';
		h=a.getElementsByTagName('dt'); s=a.getElementsByTagName('dd'); this.l=h.length;
		for(i=0;i<this.l;i++){var d=h[i]; this.arr[i]=d; d.onclick=new Function(this.nm+'.pro(this)'); if(c==i){d.className=this.sl}}
		l=s.length;
		for(i=0;i<l;i++){var d=s[i]; d.mh=d.offsetHeight; if(c!=i){d.style.height=0; d.style.display='none'}}
	}
	slider.prototype.pro=function(d){
		for(var i=0;i<this.l;i++){
			var h=this.arr[i], s=h.nextSibling; s=s.nodeType!=1?s.nextSibling:s; clearInterval(s.tm);
			if(h==d&&s.style.display=='none'){s.style.display=''; su(s,1); h.className=this.sl}
			else if(s.style.display==''){su(s,-1); h.className=''}
		}
	}
	function su(c,f){c.tm=setInterval(function(){sl(c,f)},tm)}
	function sl(c,f){
		var h=c.offsetHeight, m=c.mh, d=f==1?m-h:h; c.style.height=h+(Math.ceil(d/sp)*f)+'px';
		c.style.opacity=h/m; c.style.filter='alpha(opacity='+h*100/m+')';
		if(f==1&&h>=m){clearInterval(c.tm)}else if(f!=1&&h==1){c.style.display='none'; clearInterval(c.tm)}
	}
	return{slider:slider}
}();

function acc_df(a){$("#acc_hd"+a).show('slow');$('#acc_pm'+a).removeClass("closedlanguage");$('#acc_pm'+a).addClass("openlanguage");}

$(document).ready(function() {

	/*Tabs Code*/
	//$('.tab-parent').each(function(){
	//	$(this).find(".tab_content").hide();
	//	$(this).find("ul.tabs li:first").addClass("active").show();
	//	$(this).find(".tab_content:first").show();
	//});

	//$("ul.b_tabs li").click(function() {
		//var parents = $(this).parentsUntil('.tab-parent').parent();
		//$("li", parents).removeClass("active"); 
	//	$("li").removeClass("active");
	//	$(this).addClass("active"); 
	//	$(".tab_content").hide(); 
	
	//	var activeTab = $(this).find("a").attr("href"); 
	//	$(activeTab).fadeIn(); 
	//	return false;
	//});

	/*Tabs Code*/
	$('#newTabBN').each(function(){
		$(this).find(".tab_content").hide();
		$(this).find("#newTabBN li:first").addClass("active").show();
		$(this).find(".tab_content:first").show();
	});

	$("#newTabBN li").click(function() {
		//var parents = $(this).parentsUntil('.tab-parent').parent();
		//$("li", parents).removeClass("active"); 
		$("#newTabBN li").removeClass("active");
		$(this).addClass("active"); 
		$(".tab_content").hide(); 
	
		var activeTab = $(this).find("a").attr("href"); 
		$(activeTab).fadeIn(); 
		return false;
	});

	/*Show Hide Code*/
	$(".contentAC").hide();
	$('.colAll').hide();
	$(".expandA").click(function () {
		$(".contentAC").show('slow');
		$(this).hide();
		$('.headerAc').removeClass("closedlanguage");
		$('.headerAc').addClass("openlanguage");
		$('.colAll').fadeIn();
		show_webnews();
		getStockMessages();
	});
	$(".colAll").click(function () {
		$(".contentAC").hide('slow');
		$(this).hide();
		$('.headerAc').removeClass("openlanguage");
		$('.headerAc').addClass("closedlanguage");
		$('.expandA').fadeIn();
	});
	$('.headerAc').click(function() {
		$(this).toggleClass("closedlanguage").next().toggle('slow');
		$(this).toggleClass('openlanguage');
		return false;
	}).next().hide();
	
	/*ToolTip*/
	$("#tt01 span").hover(function() {
		$(".tooltip1").show();
			}, function() {
		$(".tooltip1").fadeOut();
	});
	$("#tt02").hover(function() {
		$(".tooltip2").show();
			}, function() {
		$(".tooltip2").fadeOut();
	});
	$("#tt03").hover(function() {
		$(".tooltip3").show();
			}, function() {
		$(".tooltip3").fadeOut();
	});
	$("#tt04").hover(function() {
		$(".tooltip4").show();
			}, function() {
		$(".tooltip4").hide();
	});
	$("#tt05").hover(function() {
		$(".tooltip5").show();
			}, function() {
		$(".tooltip5").fadeOut();
	});
	$("#tt06").hover(function() {
		$(".tooltip6").show();
			}, function() {
		$(".tooltip6").fadeOut();
	});

	/* Consumer Durables */
	$('#indicesCallout').hide();
	$('#consD').click(function(){
		$('#indicesCallout').show();						   
	});
	$('#indicesCallout').hover(function(){
		$('#indicesCallout').show();						   
	}, function(){
		$('#indicesCallout').hide();
		});
	$('#acc_pm9').click(function(){if($('#acc_pm9').attr('class')=='headerAc openlanguage'){getStockMessages();}});
	$('#acc_pm10').click(function(){show_webnews();});

});

function ttip(a, b){
if(b == 1){$("#"+a).fadeIn();}
else{$("#"+a).fadeOut();}
}

var window_focus_flag = 1;
var timer_aj;
function fade_inshow1(obj,bcolor,fcolor,olcolor)
{
	var objid=eval("document.getElementById('"+obj+"')");
	objid.style.background='#'+bcolor;
	objid.style.color='#'+fcolor;
	setTimeout("fade_outshow1('"+obj+"','','#"+olcolor+"')",3000);
}
function fade_outshow1(obj,bcolor,fcolor)
{
	var objid=eval("document.getElementById('"+obj+"')");
	objid.style.background = bcolor;
	objid.style.color = fcolor;
}

$(window).focus(function() {	
	timer_aj = window.setInterval(function() {}, 5000);
	window_focus_flag = 1;	
})
.blur(function() {
   if(timer_aj){
	  window.clearInterval(timer_aj);
	  window_focus_flag = 0;	 
   }
});
function valFormat(val){
    var fval = val;
    if(val >= 100000){ // For Lack
       fval =  (val/100000).toFixed(2);
       fval = fval+" L";
    }else if(val >= 1000){ // For Thousand
       fval = (val/1000).toFixed(2);
       fval = fval+" K";
    }
    return fval;
}
function jsonCallback(data){

        var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
        //------------Bse Section Begin---------------
        
        if(data[0]){
        
        data[0] = data[0].replace(/5DayAvg/g,'DayAvg5');
        data[0] = data[0].replace(/10DayAvg/g,'DayAvg10');
        data[0] = data[0].replace(/30DayAvg/g,'DayAvg30');
        data[0] = data[0].replace(/50DayAvg/g,'DayAvg50');
        data[0] = data[0].replace(/52H/g,'H52');
        data[0] = data[0].replace(/52L/g,'L52'); 
        
        var dataBSE = JSON.parse(data[0]);
        //if( typeof data[0] != 'undefined' &&  dataBSE.CP != "NT*" ){ 
        if(typeof data[0] == 'undefined' || !data[0] || data[0]=="null"){
            var notListedStrBSE = "<div class='gL_18 bseNot minHt110' align='center'>"+
					"<p> Stock is not listed on BSE</p>"+					
				"</div>";
             $("#content_bse").html(notListedStrBSE);
        } else if(data[0] && dataBSE.CP == "NT*"){
                var notTradedStrBSE =  "<div align='center' class='gL_18 bseNot minHt110'>"+
                        "<p>" + dataBSE.SC_COMP + " is not traded on BSE</p>"+
                    "</div>";
                    $("#content_bse").html(notTradedStrBSE);
                    
                
        }else if(dataBSE.LDAYS >= 30){
                var notTraded30StrBSE = "<div class='gL_18 bseNot minHt110' align='center'>"+					
                                    "<p>"+ dataBSE.SC_COMP +" is not traded on BSE in the last 30 days</p>"+
                            "</div>";
                $("#content_bse").html(notTraded30StrBSE);
        }else{
                
                var updTimeBse = dataBSE.lastupd;
                //var dBse = new Date(updTimeBse.substring(0, 4), updTimeBse.substring(4, 6), updTimeBse.substring(6, 8),  updTimeBse.substring(8, 10),  updTimeBse.substring(10, 12),  updTimeBse.substring(12, 14), 0);
                var dtStrBse = monthNames[updTimeBse.substring(4, 6)-1]+" "+updTimeBse.substring(6, 8)+", "+updTimeBse.substring(8, 10)+":"+updTimeBse.substring(10, 12);

                var b_price = parseFloat(dataBSE.CP);
                var b_prevclose = parseFloat(dataBSE.PC);
                var b_change = b_price - b_prevclose;
                
                //b_change = b_change;
                var b_color, b_perchange = ((b_change/b_prevclose)*100);
                //b_perchange = b_perchange;

                if( b_perchange == 'Infinity' ) {
                    b_perchange = 0;
                }
               
                var b_lastprice = parseFloat(bseNsePrice.bse);//@TODO Change
                bseNsePrice.bse = b_price;
                if(b_perchange>0)
                {
                        b_color='449703';
                        $("#Bse_Prc_tick_div").removeClass("rD_30");
                        $("#Bse_Prc_tick_div").removeClass("bD_30");
                        $("#Bse_Prc_tick_div").addClass("gD_30");                      
                        
                }
                else if(b_perchange<0)
                {
                        b_color='F01414';
                        $("#Bse_Prc_tick_div").removeClass("gD_30");
                        $("#Bse_Prc_tick_div").removeClass("bD_30");
                        $("#Bse_Prc_tick_div").addClass("rD_30");                        
                }
                else
                {
                        b_color="000";
                        $("#Bse_Prc_tick_div").removeClass("gD_30");
                        $("#Bse_Prc_tick_div").removeClass("rD_30");
                        $("#Bse_Prc_tick_div").addClass("bD_30");
                }
                
               
                if(b_price-b_lastprice > 0){//INCR
                    //To Show Blinking Green BCKGROUND Text
                    fade_inshow1('Bse_Prc_tick','449703','FFF',b_color);
                }else if(b_price-b_lastprice < 0){//DECR
                    //To Show Blinking Red BCKGROUND Text
                    fade_inshow1('Bse_Prc_tick','f01414','FFF',b_color);
                }else{
                    fade_inshow1('Bse_Prc_tick',b_color,'FFF',b_color);
                }      
                
                
                $("#bse_upd_time").html(dtStrBse);
                $("#content_bse #b_lastupdate").html(dtStrBse + '<b> | </b>');
                $("#Bse_Prc_tick").html("<strong>"+dataBSE.CP+"</strong>");

                var b_changetext;
                if(b_change > 0){
                        b_changetext = "<span class='gr_15 uparw_pc'><strong>"+b_change.toFixed(2)+"</strong></span> (+"+b_perchange.toFixed(2)+"%)";	
                }else if(b_change < 0){
                        b_changetext = "<span class='r_15 dnarw_pc'><strong>"+b_change.toFixed(2)+"</strong></span> ("+b_perchange.toFixed(2)+"%)";	
                }else{
                        b_changetext = "<span class='bk_15'><strong>"+b_change.toFixed(2)+"</strong></span> ("+b_perchange.toFixed(2)+"%)";	
                }
                $("#b_changetext").html(b_changetext);

                $("#bse_volume").html("<strong>"+dataBSE.VOL+"</strong>");
                var vol_shock_imgB;
                //alert(parseFloat(dataBSE.VOL));alert(parseFloat(dataBSE.DVolAvg5));
                if(parseFloat(dataBSE.VOL) > parseFloat(dataBSE.DVolAvg5)){
                        vol_shock_imgB = "<span class='volu_pc'></span>";
                }else{
                        vol_shock_imgB = "";
                }
                $("#vol_shock_div_B").html(vol_shock_imgB);

                var avgvol5daysB = dataBSE.DVolAvg5;
                var avgvol10daysB = dataBSE.DVolAvg10;
                var avgvol30daysB = dataBSE.DVolAvg30;

                $("#avgvol5daysB").html(avgvol5daysB);
                $("#avgvol10daysB").html(avgvol10daysB);
                $("#avgvol30daysB").html(avgvol30daysB);

                $("#avgshkrvol5daysB").html(avgvol5daysB);
                $("#avgshkrvol10daysB").html(avgvol10daysB);
                $("#avgshkrvol30daysB").html(avgvol30daysB);

                $("#b_prevclose").html("<strong>"+b_prevclose+"</strong>");
                $("#b_open").html("<strong>"+dataBSE.OPN+"</strong>");
                var BbidQ = parseFloat(dataBSE.BIDQ).toFixed(0);
                var BofferQ =  parseFloat(dataBSE.OFFERQ).toFixed(0);
                $("#b_bidprice_qty").html("<strong>"+dataBSE.BIDP+"("+BbidQ+")"+"</strong>");
                $("#b_offerprice_qty").html("<strong>"+dataBSE.OFFERP+"("+BofferQ+")"+"</strong>");

                var b_high = parseFloat(dataBSE.HP);
                var b_low = parseFloat(dataBSE.LP);
                var b_52high = parseFloat(dataBSE.H52);
                var b_52low = parseFloat(dataBSE.L52);

                var bse_range = ((b_price - b_low)*100)/(b_high - b_low);
                var bse_52range = ((b_price - b_52low)*100)/(b_52high - b_52low);
                bse_range = bse_range.toFixed(0);
                bse_52range = bse_52range.toFixed(0);

                var b_high_sh = parseFloat(dataBSE.HP);
                var b_low_sh = parseFloat(dataBSE.LP);
                var  b_52highStr="";
                var  b_high_shStr="";
                var  b_52lowStr="";
                var  b_low_shStr="";
                
                if(b_high >= b_52high)	//if it touched 52 week high today
                {
                        
                        b_52highStr = "<span class='gr_11'>"+b_high.toFixed(2)+"</span>";
                        b_high_shStr = "<span class='gr_11'>"+b_high.toFixed(2)+"</span>";
                }else{
                        b_52highStr = "<span >"+b_52high.toFixed(2)+"</span>";
                        b_high_shStr = "<span >"+b_high_sh.toFixed(2)+"</span>";
                }

                if(b_low <= b_52low)	//	if it touched 52 week low today
                {
                        b_52lowStr = "<span class='r_11'>"+b_low.toFixed(2)+"</span>";
                        b_low_shStr = "<span class='r_11'>"+b_low.toFixed(2)+"</span>";
                }else{
                        b_52lowStr = "<span >"+b_52low.toFixed(2)+"</span>";
                        b_low_shStr = "<span >"+b_low_sh.toFixed(2)+"</span>";
                }
                
                $("#b_low_sh").html(b_low_shStr);
                $("#b_high_sh").html(b_high_shStr);
                $("#b_52low").html(b_52lowStr);
                $("#b_52high").html(b_52highStr);

                $("#bse_range").attr("style","widt  h:"+bse_range+"%");
                $("#bse_52range").attr("style","width:"+bse_52range+"%");
                
                var best_5_str = "<tr>"+
                                        "<th colspan='2' class='brdr grn'>BUY</th>"+
                                        "<th colspan='2' class='red'>SELL</th>"+
                                "</tr>"+
                                "<tr>"+
                                        "<td class='brdb'><strong>QTY</strong></td>"+
                                        "<td class='brdb brdr tar'><strong>PRICE</strong></td>"+
                                        "<td class='brdb'><strong>PRICE</strong></td>"+
                                        "<td class='brdb tar'><strong>QTY</strong></td>"+
                                "</tr>";
                if(dataBSE.best_5_set){
                    $.each(dataBSE.best_5_set,function(key, arr){	
                        best_5_str = best_5_str + "<tr>"+
                                                            "<td>"+(arr.buyqty==0?"-":arr.buyqty)+"</td>"+
                                                            "<td class='brdr tar'>"+(arr.buyqty==0?"-":arr.buyrate)+"</td>"+
                                                            "<td>"+(arr.sellrate==0?"-":arr.sellrate)+"</td>"+
                                                            "<td class='tar'>"+(arr.sellqty==0?"-":arr.sellqty)+"</td>"+
                                                    "</tr>";
                    });
                } 
                

                best_5_str = best_5_str + "<tr>"+
                        "<td id='b_tot_total_buy_qty' class='brdt'><strong>"+parseInt(dataBSE.tot_buy_qty)+"</strong></td>"+
                        "<td class='brdt brdr tar UC'><strong>Total</strong></td>"+
                        "<td class='brdt UC'><strong>TOTAL</strong></td>"+
                        "<td id='b_tot_total_sell_qty' class='brdt tar'><strong>"+parseInt(dataBSE.tot_sell_qty)+"</strong></td>"+
                "</tr>";
            
                $("#best_5_box_table").html(best_5_str);

                $("#b_vwap_val").html(dataBSE.AVGP);
                $("#b_low_price_limit").html(dataBSE.lower_circuit_limit);
                $("#b_high_price_limit").html(dataBSE.upper_circuit_limit);
                
                
                
                var tot_buy_qty = parseInt(dataBSE.tot_buy_qty);
                var tot_sell_qty = parseInt(dataBSE.tot_sell_qty);

                $("#b_total_buy_qty").html(valFormat(tot_buy_qty));
                $("#b_total_sell_qty").html(valFormat(tot_sell_qty));
                var effactRange;
                if(tot_sell_qty > 0){
                    effactRange = tot_buy_qty/tot_sell_qty;
                }else if(tot_sell_qty == 0){
                    effactRange = 2;
                }
                if(effactRange>=2){
                    $("#md_name").removeClass("gL_10");
                    $("#md_name").removeClass("gr_10");
                    $("#md_name").addClass("gr_10");

                }else if(effactRange<0.5){

                    $("#md_name").removeClass("gL_10");
                    $("#md_name").removeClass("gr_10");
                    $("#md_name").addClass("r_10");
                }
                
        }
        //---------------------Bse Section End-----------------
        
        //---------------------Nse Section Begin-----------------
        }
        
        if(data[1]){
        data[1] = data[1].replace(/5DayAvg/g,'DayAvg5');
        data[1] = data[1].replace(/10DayAvg/g,'DayAvg10');
        data[1] = data[1].replace(/30DayAvg/g,'DayAvg30');
        data[1] = data[1].replace(/50DayAvg/g,'DayAvg50');
        data[1] = data[1].replace(/52H/g,'H52');
        data[1] = data[1].replace(/52L/g,'L52');       
        var dataNSE = JSON.parse(data[1]);
        
        if(typeof data[1] == 'undefined' || !data[1] || data[0]=="null"){
                var notListedStrNSE = "<div class='gL_18 nseNot minHt110' align='center'>"+
                                            "<p>Stock is not listed on NSE</p>"+					
                                    "</div>";
                 $("#content_nse").html(notListedStrNSE);
        } else if(data[0] && dataNSE.CP == "NT*"){
                var notTradedStrNSE =  "<div align='center' class='gL_18 bseNot minHt110'>"+
                        "<p>" + dataNSE.SC_COMP + " is not traded on NSE</p>"+
                    "</div>";
                    $("#content_nse").html(notTradedStrNSE);
                    //alert("inside NSE");
                
        }else if(dataNSE.LDAYS >= 30){
                var notTraded30StrNSE = "<div class='gL_18 nseNot minHt110' align='center'>"+					
                                    "<p>"+ dataNSE.SC_COMP +" is not traded on NSE in the last 30 days</p>"+
                            "</div>";
        }else{
                              
                var updTimeNse = dataNSE.lastupd;
                //var dNse = new Date(updTimeNse.substring(0, 4), updTimeNse.substring(4, 6), updTimeNse.substring(6, 8),  updTimeNse.substring(8, 10),  updTimeNse.substring(10, 12),  updTimeNse.substring(12, 14), 0);
                var dtStrNse = monthNames[updTimeNse.substring(4, 6)-1]+" "+updTimeNse.substring(6, 8)+", "+updTimeNse.substring(8, 10)+":"+updTimeNse.substring(10, 12);

                var n_price = parseFloat(dataNSE.CP);
                var n_prevclose = parseFloat(dataNSE.PC);
                var n_change = n_price - n_prevclose;
                //n_change = n_change;
                var n_color, n_perchange = ((n_change/n_prevclose)*100);
                // n_perchange = n_perchange;

                if( n_perchange == 'Infinity' ) {
                    n_perchange = 0;
                }
                
                var n_lastprice = parseFloat(bseNsePrice.nse);//@TODO Change
                bseNsePrice.nse = n_price;
                
                if(n_perchange>0)
                {
                        
                        n_color='449703';
                        $("#Nse_Prc_tick_div").removeClass("rD_30");
                        $("#Nse_Prc_tick_div").removeClass("bD_30");

                        $("#Nse_Prc_tick_div").addClass("gD_30");
                }
                else if(n_perchange<0)
                {
                        
                        n_color='F01414';
                        $("#Nse_Prc_tick_div").removeClass("gD_30");
                        $("#Nse_Prc_tick_div").removeClass("bD_30");

                        $("#Nse_Prc_tick_div").addClass("rD_30");
                }
                else
                {
                        n_color="000";
                        $("#Nse_Prc_tick_div").removeClass("gD_30");
                        $("#Nse_Prc_tick_div").removeClass("rD_30");

                        $("#Nse_Prc_tick_div").addClass("bD_30");
                }
                
                if(n_price-n_lastprice > 0){//INCR
                    //To Show Blinking Green BCKGROUND Text
                    fade_inshow1('Nse_Prc_tick','449703','FFF',n_color);                    
                }else if(n_price-n_lastprice < 0){//DECR
                    //To Show Blinking Red BCKGROUND Text
                    fade_inshow1('Nse_Prc_tick','f01414','FFF',n_color);
                }else{
                     //To Show Blinking Red BCKGROUND Text
                    fade_inshow1('Nse_Prc_tick',n_color,'FFF',n_color);
                }
                
                $("#nse_upd_time").html(dtStrNse);
                $("#content_nse #b_lastupdate").html(dtStrNse + ' <b> | </b>');
                $("#Nse_Prc_tick").html("<strong>"+dataNSE.CP+"</strong>");

                var n_changetext;
                if(n_change > 0){
                        n_changetext = "<span class='gr_15 uparw_pc'><strong>"+n_change.toFixed(2)+"</strong></span> (+"+n_perchange.toFixed(2)+"%)";	
                }else if(n_change < 0){
                        n_changetext = "<span class='r_15 dnarw_pc'><strong>"+n_change.toFixed(2)+"</strong></span> ("+n_perchange.toFixed(2)+"%)";	
                }else{
                        n_changetext = "<span class='bk_15'><strong>"+n_change.toFixed(2)+"</strong></span> ("+n_perchange.toFixed(2)+"%)";	
                }
                $("#n_changetext").html(n_changetext);

                $("#nse_volume").html("<strong>"+dataNSE.VOL+"</strong>");
                var vol_shock_imgN;
                if(parseFloat(dataNSE.VOL) > parseFloat(dataNSE.DVolAvg5)){
                        vol_shock_imgN = "<span class='volu_pc'></span>";
                }else{
                        vol_shock_imgN = "";
                }
                $("#vol_shock_div_N").html(vol_shock_imgN);

                var avgvol5daysN = dataNSE.DVolAvg5;//@TODO Change Vol
                var avgvol10daysN = dataNSE.DVolAvg10;//@TODO Change Vol
                var avgvol30daysN = dataNSE.DVolAvg30;//@TODO Change Vol

                $("#avgvol5daysN").html(avgvol5daysN);
                $("#avgvol10daysN").html(avgvol10daysN);
                $("#avgvol30daysN").html(avgvol30daysN);

                $("#avgshkrvol5daysN").html(avgvol5daysN);
                $("#avgshkrvol10daysN").html(avgvol10daysN);
                $("#avgshkrvol30daysN").html(avgvol30daysN);

                $("#n_prevclose").html("<strong>"+n_prevclose+"</strong>");
                $("#n_open").html("<strong>"+dataNSE.OPN+"</strong>");
                var NbidQ = parseFloat(dataNSE.BIDQ).toFixed(0);
                var NofferQ = parseFloat(dataNSE.OFFERQ).toFixed(0);
                $("#n_bidprice_qty").html("<strong>"+dataNSE.BIDP+"("+NbidQ+")"+"</strong>");
                $("#n_offerprice_qty").html("<strong>"+dataNSE.OFFERP+"("+NofferQ+")"+"</strong>");

                var n_high = parseFloat(dataNSE.HP);
                var n_low = parseFloat(dataNSE.LP);
                var n_52high = parseFloat(dataNSE.H52);
                var n_52low = parseFloat(dataNSE.L52);
                                
                var nse_range = ((n_price - n_low)*100)/(n_high - n_low);
                var nse_52range = ((n_price - n_52low)*100)/(n_52high - n_52low);
                nse_range = nse_range.toFixed(0);
                nse_52range = nse_52range.toFixed(0);

                var n_high_sh = parseFloat(dataNSE.HP);
                var n_low_sh = parseFloat(dataNSE.LP);

                var n_52highStr = "";
                var n_high_shStr = "";
                var n_52lowStr = "";
                var n_low_shStr = "";
                if(n_high >= n_52high)	//	if it touched 52 week high today
                {
                        n_52highStr = "<span class='gr_11'>"+n_high.toFixed(2)+"</span>";
                        n_high_shStr = "<span class='gr_11'>"+n_high.toFixed(2)+"</span>";
                }else{
                        n_52highStr = "<span >"+n_52high.toFixed(2)+"</span>";
                        n_high_shStr = "<span >"+n_high_sh.toFixed(2)+"</span>";
                }

                if(n_low <= n_52low)	//	if it touched 52 week low today
                {
                        n_52lowStr = "<span class='r_11'>"+n_low.toFixed(2)+"</span>";
                        n_low_shStr = "<span class='r_11'>"+n_low.toFixed(2)+"</span>";
                }else{
                        n_52lowStr = "<span >"+n_52low.toFixed(2)+"</span>";
                        n_low_shStr = "<span >"+n_low_sh.toFixed(2)+"</span>";
                }
                $("#n_low_sh").html(n_low_shStr);
                $("#n_high_sh").html(n_high_shStr);
                $("#n_52low").html(n_52lowStr);
                $("#n_52high").html(n_52highStr);

                $("#nse_range").attr("style","width:"+nse_range+"%");
                $("#nse_52range").attr("style","width:"+nse_52range+"%");
                
                
                $("#n_low_price_limit").html(dataNSE.lower_circuit_limit);
                $("#n_high_price_limit").html(dataNSE.upper_circuit_limit);
            
            
            
        }
        }
        //------------------ Nse Section End -------------------
        
}
function get_pricechart_div_data(bseid,nseid,scid,dvid,page,indx){
    //var dataUrl ='http://172.18.10.104/mc_get/g.js?key=stk_SBI_B%20stk_SBI_N&type=mget';
    var dataUrl ='https://pricefeed.moneycontrol.com/mc_get/g.js?key='+bseid+'%20'+nseid+'&type=mget';
    
    $.ajax({
        url: dataUrl,
        type: 'GET',
        cache:true,
        jsonpCallback:"jsonCallback",
        dataType: 'jsonp',         
        success: function(jsonp) { 
               // Goes to callback function 'jsonCallback'           
        },
        error:function(){
            //alert("Error occured.");
        }
    });
}

function get_data_disp(bseid,nseid,scid,dvid,page,indx)
{       
	if(window_focus_flag == 1)
	{	
                bseid = "stk_"+scid+"_B"
                nseid = "stk_"+scid+"_N"
                get_pricechart_div_data(bseid,nseid,scid,dvid,page,indx);
                
		/*if(page=='ins')
			var ins_val = 'ins=1';
		else
			var ins_val = 'ins=';

		$('#content_'+dvid).load('https://www.moneycontrol.com/mccode/common/get_pricechart_div.php?bse_id='+bseid+'&nse_id='+nseid+'&sc_id='+scid+'&BNsetick='+bprice_tick+'&'+ins_val+'&sc_mapindex='+indx, '', function(data) 
		{
			    var pc_dat = data.split("@!@");
				$('#content_'+dvid).html(pc_dat[0]);
				
				if(pc_dat[1]!='' && pc_dat[1].length>3){
					var sensexcompany_array = pc_dat[1].split("|");
					
					var sensex_prevval = sensexcompany_array[0]; 
					var sensex_currval = sensexcompany_array[1];
					var sensex_perchange = sensexcompany_array[2];
					var company_prevval = sensexcompany_array[3];
					var company_currval = sensexcompany_array[4];
					var company_perchange = sensexcompany_array[5];

					$("#id_scv").html(parseFloat(sensex_currval).toFixed(2));
					$("#id_spv").html('<strong>'+parseFloat(sensex_prevval).toFixed(2)+'</strong>');
					$("#id_spc").html(parseFloat(sensex_perchange).toFixed(2)+"%");

					$("#id_ccv").html(parseFloat(company_currval).toFixed(2));
					$("#id_cpv").html('<strong>'+parseFloat(company_prevval).toFixed(2)+'</strong>');
					$("#id_cpc").html(parseFloat(company_perchange).toFixed(2)+"%");
					
					if(sensex_perchange<0){ 
						$("#id_scv").removeClass().addClass("r_13"); 
						$("#id_spc").removeClass().addClass("r_13");
						$("#id_sa").removeClass().addClass("dnarw_pc");
					}else{
						$("#id_scv").removeClass().addClass("gr_13");
						$("#id_spc").removeClass().addClass("gr_13");
						$("#id_sa").removeClass().addClass("uparw_pc");
					}
					
					if(company_perchange<0){ 
						$("#id_ccv").removeClass().addClass("r_13");
						$("#id_cpc").removeClass().addClass("r_13");
						$("#id_ca").removeClass().addClass("dnarw_pc");
					}else{  
						$("#id_ccv").removeClass().addClass("gr_13");
						$("#id_cpc").removeClass().addClass("gr_13");
						$("#id_ca").removeClass().addClass("uparw_pc");
					}

					$("#sensex_high").show();
				}
					
				
		});*/
	}
}
function get_data_disp_pre_new(bseid,nseid,scid,dvid,bprice_pre)
{
	if(window_focus_flag == 1)
	{			
		var ins_val = 'ins=';
		$('#precontent_new_'+dvid).load('https://www.moneycontrol.com/mccode/common/get_pre_pricechart_div.php?bse_id='+bseid+'&nse_id='+nseid+'&sc_id='+scid+'&BNsetick='+prebprice_tick+'&'+ins_val+'&BNsepre='+bprice_pre, '', function(data) 
		{
				$('#precontent_new_'+dvid).html(data);
		});
	}
}
function get_data_disp_pre(bseid,nseid,scid,dvid,bprice_pre)
{
	if(window_focus_flag == 1)
	{			
		var ins_val = 'ins=2';
		$('#precontent_'+dvid).load('https://www.moneycontrol.com/mccode/common/get_pricechart_div.php?bse_id='+bseid+'&nse_id='+nseid+'&sc_id='+scid+'&BNsetick='+prebprice_tick+'&'+ins_val+'&BNsepre='+bprice_pre, '', function(data) 
		{
				$('#precontent_'+dvid).html(data);
		});
	}
}

function get_histprice(ex, period)
{
	if(ex == "B")
	{
		mytmpobj=document.bsehist_frm;
		document.getElementById("disp_bse_hist").innerHTML = "Loading...";
	}
	else
	{
		mytmpobj=document.nsehist_frm;
		document.getElementById("disp_nse_hist").innerHTML = "Loading...";
	}

	var sc_id = mytmpobj.sc_id.value;
	var open = mytmpobj.open.value;
	var high = mytmpobj.high.value;
	var low = mytmpobj.low.value;
	var close = mytmpobj.close.value;
	var vol = mytmpobj.vol.value;

	if(period == "0")
	{
		var sel_dd = mytmpobj.dd.value;
		var sel_mm = mytmpobj.mm.value;
		var sel_yy = mytmpobj.yy.value;

		if(sel_dd == "")
		{
			alert("Please select a day");
			mytmpobj.dd.focus();
			return false;
		}
		if(sel_mm == "")
		{
			alert("Please select a month");
			mytmpobj.mm.focus();
			return false;
		}
		if(sel_yy == "")
		{
			alert("Please select a year");
			mytmpobj.yy.focus();
			return false;
		}
		
		var sel_date = sel_yy+""+sel_mm+""+sel_dd;

		datafile = "https://www.moneycontrol.com/stocks/company_info/get_histprices.php?ex="+ex+"&sc_id="+sc_id+"&range="+period+"&sel_date="+sel_date+"&curr_open="+open+"&curr_high="+high+"&curr_low="+low+"&curr_close="+close+"&curr_vol="+vol;
	}
	else
	{
		datafile = "https://www.moneycontrol.com/stocks/company_info/get_histprices.php?ex="+ex+"&sc_id="+sc_id+"&range="+period+"&curr_open="+open+"&curr_high="+high+"&curr_low="+low+"&curr_close="+close+"&curr_vol="+vol;
	}

	if(!IE)
		var objXml = new XMLHttpRequest();
	else
		var objXml = new ActiveXObject("Microsoft.XMLHTTP");

	objXml.open("GET", datafile, true);
	objXml.setRequestHeader("Cache-Control","no-cache"); 
	objXml.onreadystatechange=function() 
	{
		if (objXml.readyState==4) 
		{
			if (objXml.status!=404)
			{
				if((objXml.responseText).length > 0)
				{
					if(ex == "B")
					{
						document.getElementById("disp_bse_hist").innerHTML = objXml.responseText;
					}
					else
					{
						document.getElementById("disp_nse_hist").innerHTML = objXml.responseText;
					}
				}
			}
		}
	}
	objXml.send(null);
	return false;
}


//------ News Across web -------//
function show_webnews()
{	
	var callout_html=$("#nweb").html();
	if(callout_html=='')
	{
		var compname = $("#compname_imp").val();
		$("#nweb").html('<div class="grybg PA10 MB3" align="center"><img src="https://img-d02.moneycontrol.co.in/images/markets_new_loader.gif" valing="center" align="center"></div>');
		$('#nweb').load('https://www.moneycontrol.com/stocks/company_info/news_videos_web.php?query='+escape(compname), '', function(data) 
		{
				$('#nweb').html(data);
		});								
	}						
}
//---------- Stock Messages --------------------//
function getStockMessages(){
	 try{
		 var preload_msgs = $("#preload_msgs").val();
		 if(preload_msgs=='undefined' || preload_msgs=='')var preload_msgs=0;
	 }catch(e){
          var preload_msgs=0;
	 }
	 var htmdata = $("#stkmessages").html();
	 if(htmdata=='' || preload_msgs==1){
		 var id = $("#compid_imp").val();
		 $("#stkmessages").html('<div class="grybg PA10 MB3" align="center"><img src="https://img-d02.moneycontrol.co.in/images/markets_new_loader.gif" valing="center" align="center"></div>'); 
		 $.post("https://www.moneycontrol.com/stocks/company_info/stock-messages.php",{sc_id:id},function(data){
			$("#stkmessages").html(data);
		 });
	 }
}

/*----------- Stock Alert Element ------------*/
function toHex(str) {
	var hex = '';
	for(var i=0;i<str.length;i++) {
		hex += ''+str.charCodeAt(i).toString(16);
	}
	return hex;
}
function strrev(str) {
   if (!str) return '';
   var revstr='';
   for (i = str.length-1; i>=0; i--)
	   revstr+=str.charAt(i)
   return revstr;
}
function trim(str) { 
	var	str1 = str.replace(/^\s\s*/,''),
		ws = /\s/,
		i = str1.length;
	while (ws.test(str1.charAt(--i)));
	return str1.slice(0, i + 1);

}
function checkEmail(email) {
	if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(email)){
		return (true);
	}
	return (false);
}

function chk(ele)
{
	if(isNaN(ele.value))
	{
		ele.value="";
		alert("Numeric value required")
		ele.focus();
	}
}

function IsNumeric(strString)
{
   var strValidChars = "0123456789";
   var strChar;
   var blnResult = true;

   if (strString.length == 0) return false;

   //  test strString consists of valid characters listed above
   for (i = 0; i < strString.length && blnResult == true; i++)
      {
      strChar = strString.charAt(i);
      if (strValidChars.indexOf(strChar) == -1)
         {
         blnResult = false;
         }
      }
   return blnResult;
}

function set_stkalert(scid){
  if(scid!=''){
	 $.post("https://www.moneycontrol.com/alerts/set_mktalert.php",{scid:escape(scid),act:'mktalert'},function(result){
		$("#alert_container").html(result);
		$("#mcalertDiv").show();
	 });
  }
}

function login_prompt(loginid,alert_email,stkid,stkname,frequency){
  
   if(loginid!='')var loginid_str='"<span class="b_13"><strong><em>'+loginid+'</em></strong></span>"'; 
   else var loginid_str='';
   var loginstr = '<form method="post" onsubmit="return validatemc_login(this)"><p class="gL_13 PB15 brdb"><strong><em>We notice that this Email ID is already verified against Moneycontrol User ID '+loginid_str+'. Just enter your password and <span class="b_13"><strong><em>login</em></strong></span> to Set Alert.</em></strong></p><div class=" PB15 brdb"><table cellspacing="0" border="0" width="255" class="MT10"><tr><td width="100"><span class="b_15"><strong>Login:</strong></span></td><td><input type="text" name="alertlogin" id="alertlogin" style="width:150px" class="gL_15 PA3 MT10" value="'+loginid+'"></td></tr><tr><td width="100"><span class="b_15"><strong>Password:</strong></span></td><td><input type="password" name="alertpass" id="alertpass" style="width:150px" class="gL_15 PA3 MT10" value=""></td></tr><tr><td colspan="2" align="right"><p class="MT5"><span id="sbmtspan"><input type="image" src="https://img-d02.moneycontrol.co.in/images/mc_alerts/set_alert.gif" /></span></p><p class="MT5"><a href="https://www.moneycontrol.com/login/commonforgotpassword.php" class="b_11" style="text-decoration:underline;">Forgot Password?</a></p></td></tr></table><input type="hidden" name="stkid" id="stkid" value="'+stkid+'"><input type="hidden" name="alert_email" id="alert_email" value="'+alert_email+'">   <input type="hidden" name="stkname" id="stkname" value="'+stkname+'"><input type="hidden" name="frequency" id="frequency" value="'+frequency+'"></form>';
   return loginstr;
}


function thankyou_msg(email,stkname){
   var msg_str = '<p class="gL_14"><em>Your Alert request for "'+stkname+'" has been created and a verification email has been sent to</em> <a href="mailto:222@gmail.com." class="bl_14"><em>'+email+'</em></a></p><p class="b_13 PB15 brdb MT10"><strong><em>Click the link in the verification email and confirm your request to start receiving moneycontrol alerts on '+stkname+'</em></strong></p><p class="gL_10 MT15">Note - In most cases you should receive the verification mail within minutes, if not please check your SPAM / Junk Mail folders for the mail. In some cases depending on your email system it could take longer, however, if you don\'t get an email from us within half an hour, please write to us at  <a href="mailto:mcalerts@moneycontrol.com." class="bl_10">mcalerts@moneycontrol.com.</a></p>';
   return msg_str;
}


function validat_stkalert(prelogin){
	var alert_email = trim($('#alert_email').val());
	var frequency = trim($('#frequency').val());
	var stkid = trim($('#stkid').val());
	var stkname = trim($('#stkname').val());

	if(frequency==''){
		alert("please select how often you want this alert.");
		document.getElementById("frequency").focus();
		return false;
	}else
	if(alert_email==''){
		alert("please enter your email Id.");
		document.getElementById("alert_email").focus();
		return false;
	}else
	if(checkEmail(alert_email)==false){
		alert("please enter valid email address.");
		document.getElementById("alert_email").focus();
		return false;
	}else{
		$("#sbmtspan").html('<image src="https://img-d02.moneycontrol.co.in/images/markets_new_loader.gif" />');
		$.post("https://www.moneycontrol.com/alerts/save_alerts.php",{ids:stkid,frqns:frequency,email:alert_email,stkcon:''},function(result){
			var res_arr = result.split('~');
			result = res_arr[0];
			if(result=='login_prompt'){
				 var loginid = res_arr[1];
				 var loginstr = login_prompt(loginid,alert_email,stkid,stkname,frequency);
				 $("#maincontainer").html(loginstr); 
				 return false;
			}else{
				if(prelogin==1){
					var msg_str = thankyou_msg(alert_email,stkname);
					$("#maincontainer").html(msg_str); 
					 return false;
				}else{
					window.location = "https://www.moneycontrol.com/alerts/manage-alerts.php?msg=stkwatch#stkwatch";
				}
			}
	    });
       	return false;
	}
	return false;
}

function validatemc_login(frm){
	var alertlogin = trim($('#alertlogin').val());
	var alertpass = trim($('#alertpass').val());
	var alert_email = frm.alert_email.value;
	try{
		var wid = frm.wid.value;
	}catch(err){
        var wid ='';
	}
	if(alertlogin==''){
		alert("Please enter your Username");	
		document.getElementById("alertlogin").focus();
		return false;
	}else
	if(alertpass==''){
		alert("Please enter your Password");
		document.getElementById("alertpass").focus();
		return false;
	}else{
		    $("#sbmtspan").html('<image src="https://img-d02.moneycontrol.co.in/images/markets_new_loader.gif" />');
			datafile = "https://www.moneycontrol.com/alerts/chk_verify_email.php?username="+alertlogin+"&email="+alert_email;
			$.post(datafile, function(data){
				if(data==0){
					alert("This username is not the one verified against this email address.\nPlease enter correct username.");
					$("#sbmtspan").html('<input type="image" src="https://img-d02.moneycontrol.co.in/images/mc_alerts/set_alert.gif" align="absmiddle">');
					return false;
				}else{
					file = "https://www.moneycontrol.com/watchlist1/login_check.php?sectionid=alerts&username="+alertlogin+"&password="+alertpass;
					$.post(file, function(result){
						if(result=='alldone'){
							if(wid=='')validat_stkalert();
							else chk_mktwatchalert(0);
						}else{
							alert("Invalid username or password.");   
							document.getElementById("alertpass").focus();
							$("#sbmtspan").html('<input type="image" src="https://img-d02.moneycontrol.co.in/images/mc_alerts/set_alert.gif" align="absmiddle">');
							return false;
						}
					});
				}
			});
	}
	return false;
}
/*##### end #######*/



/*###### Market watch common element ########*/
function set_mktwatchalert(id){
	if(id!=''){
		 $.post("https://www.moneycontrol.com/alerts/set_mktwatch.php",{id:escape(id)},function(result){
			$("#alert_container2").html(result);
			$("#mcalertDiv2").show();
		 });
	}
}
function login_prompt2(loginid,alert_email,wid,data_str,mwname){
  
   if(loginid!='')var loginid_str='"<span class="b_13"><strong><em>'+loginid+'</em></strong></span>"'; 
   else var loginid_str='';
   var loginstr = '<form method="post" onsubmit="return validatemc_login(this)"><p class="gL_13 PB15 brdb"><strong><em>We notice that this Email ID is already verified against Moneycontrol User ID '+loginid_str+'. Just enter your password and <span class="b_13"><strong><em>login</em></strong></span> to Set Alert.</em></strong></p><div class=" PB15 brdb"><table cellspacing="0" border="0" width="255" class="MT10"><tr><td width="100"><span class="b_15"><strong>Login:</strong></span></td><td><input type="text" name="alertlogin" id="alertlogin" style="width:150px" class="gL_15 PA3 MT10" value="'+loginid+'"></td></tr><tr><td width="100"><span class="b_15"><strong>Password:</strong></span></td><td><input type="password" name="alertpass" id="alertpass" style="width:150px" class="gL_15 PA3 MT10" value=""></td></tr><tr><td colspan="2" align="right"><p class="MT5"><span id="sbmtspan"><input type="image" src="https://img-d02.moneycontrol.co.in/images/mc_alerts/set_alert.gif" /></span></p><p class="MT5"><a href="https://www.moneycontrol.com/login/commonforgotpassword.php" class="b_11" style="text-decoration:underline;">Forgot Password?</a></p></td></tr></table><input type="hidden" name="alert_email" id="alert_email" value="'+alert_email+'">   <input type="hidden" name="wid" id="wid" value="'+wid+'"><input type="hidden" name="time_str" id="time_str" value="'+data_str+'"><input type="hidden" name="mwname" id="mwname" value="'+mwname+'"></form>';
   return loginstr;
}

function chk_mktwatchalert(prelogin){
var alert_email = trim($('#alert_email').val());
var time_str = trim($('#time_str').val());
var wid = trim($('#wid').val());
var mwname = trim($('#mwname').val());
var mktstr = '\n'+wid+'=>'+time_str; 
if(alert_email==''){
	alert("Please enter email id.");
	document.getElementById("alert_email").focus();
	return false;
}else 
if(checkEmail(alert_email)==false){
	alert("please enter valid email address.");
	document.getElementById("alert_email").focus();
	return false;
}else{
   $.post("https://www.moneycontrol.com/alerts/update_mkt_alerts.php",{email:escape(alert_email),mktdata:escape(mktstr),mkt_consol:''},function(result){
		var res_arr = result.split('~');
        result = res_arr[0];
		if(result=='login_prompt'){
			var loginid = res_arr[1];
			var loginstr = login_prompt2(loginid,alert_email,wid,time_str,mwname);
			$("#maincontainer2").html(loginstr); 
			return false;
		}else{
				if(prelogin==1){
					var msg_str = thankyou_msg(alert_email,mwname);
					$("#maincontainer2").html(msg_str); 
					 return false;
				}else{
					window.location = "https://www.moneycontrol.com/alerts/manage-alerts.php?msg=mktalert#mktalert";
				}
			}
	});
	
}
return false;
}
/* mkt watch elemet end*/

/*floating left menu*/
function flotiangLeftMenu( fw, marginleft ) {
    $j = jQuery;
    $j(document).ready(function($) {
        var $floatingbox = $('#floating-box');
        if($.browser.msie && $.browser.version=="6.0") {
        } else {
            if($('.rightCont').length > 0) {
                var bodyY = parseInt($('.rightCont').offset().top) - 20;
                var originalX = parseInt($floatingbox.css('margin-left')) + fw;
                $(window).scroll(function () {
                    var scrollY = $(window).scrollTop();
                    var isfixed = $floatingbox.css('position') == 'fixed';
                    var footer_height = $('footer').height();
                    var rightCont_height = $('.rightCont').height();
                    var leftNav_height = $('.leftNav').height();

                    if($floatingbox.length > 0){
                        // if( scrollY > bodyY && !isfixed ) {
                        if( scrollY > bodyY ) {

                            $floatingbox.stop().css({
                                position: 'fixed',
                                left: '50%',
                                top: 10,
                                marginLeft: marginleft
                            });
                        // } else if( scrollY < bodyY && isfixed ) {
                        } else if( scrollY < bodyY ) {

                            $floatingbox.css({
                                position: 'absolute',
                                left: 0,
                                top: 0,
                                marginLeft: originalX
                            });
                        }

                        if( (scrollY-footer_height-250) >= (rightCont_height-leftNav_height) ) {
                             $floatingbox.stop().css({
                                position: 'fixed',
                                left: '50%',
                                top: '-350px',
                                marginLeft: marginleft
                            });
                        }
                    }
                });
            }
        }
    });
}

function getm3usrdetail(){
	 var host ='https://mmb.moneycontrol.com/';
	var totmsgcnt=$("#totmsgcnt").val();
	
	$.ajax({
            url: host + 'india/messageboard/tp_ajax_user_photo.php?section=JS',
            type: 'GET',
			cache:true,
			jsonpCallback:"cb",
            dataType: 'jsonp', 
			success: function(jsonp) { 
				$.each(jsonp,function(i,v){	
    				var nic_nm='<span class=bl_12><strong>'+v.nic_nm+'</strong></span>';
    				for(var i=1;i<=totmsgcnt;i++){
        				$("#thumb_reply_"+i).html(v.image);
        				$("#ratemsg_img_"+i).html(v.image);
        				$("#repost_img_"+i).html(v.image);
        				$("#ratemsg_usr_"+i).html(nic_nm);
        				$("#nk_reply_"+i).html(nic_nm);
        				$("#repost_usr_"+i).html(nic_nm);
    				}
				});
            }
        });
	 
 }